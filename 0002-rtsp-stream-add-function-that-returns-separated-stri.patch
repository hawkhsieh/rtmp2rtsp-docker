From 5d28251f5fa2db18fa06eda5e29e157f30b5c5d0 Mon Sep 17 00:00:00 2001
From: sonntex <sonntex@gmail.com>
Date: Sun, 24 Dec 2017 14:30:49 +0300
Subject: [PATCH 2/2] rtsp-stream: add function that returns separated string
 of udp clients

---
 gst/rtsp-server/rtsp-stream.c | 15 +++++++++++++++
 gst/rtsp-server/rtsp-stream.h |  2 ++
 2 files changed, 17 insertions(+)

diff --git a/gst/rtsp-server/rtsp-stream.c b/gst/rtsp-server/rtsp-stream.c
index 6e8c97a..2379352 100644
--- a/gst/rtsp-server/rtsp-stream.c
+++ b/gst/rtsp-server/rtsp-stream.c
@@ -2285,6 +2285,21 @@ gst_rtsp_stream_get_publish_clock_mode (GstRTSPStream * stream)
   return ret;
 }
 
+gchar *
+gst_rtsp_stream_get_clients (GstRTSPStream * stream)
+{
+  GstRTSPStreamPrivate *priv;
+  gchar *ret = NULL;
+
+  priv = stream->priv;
+  g_mutex_lock (&priv->lock);
+  if (priv->udpsink[0])
+    g_object_get (G_OBJECT (priv->udpsink[0]), "clients", &ret, NULL);
+  g_mutex_unlock (&priv->lock);
+
+  return ret;
+}
+
 static GstCaps *
 request_pt_map (GstElement * rtpbin, guint session, guint pt,
     GstRTSPStream * stream)
diff --git a/gst/rtsp-server/rtsp-stream.h b/gst/rtsp-server/rtsp-stream.h
index 9ef887a..c41ff1f 100644
--- a/gst/rtsp-server/rtsp-stream.h
+++ b/gst/rtsp-server/rtsp-stream.h
@@ -182,6 +182,8 @@ gboolean          gst_rtsp_stream_allocate_udp_sockets       (GstRTSPStream * st
 void                    gst_rtsp_stream_set_publish_clock_mode (GstRTSPStream * stream, GstRTSPPublishClockMode mode);
 GstRTSPPublishClockMode gst_rtsp_stream_get_publish_clock_mode (GstRTSPStream * stream);
 
+gchar *           gst_rtsp_stream_get_clients      (GstRTSPStream * stream);
+
 /**
  * GstRTSPStreamTransportFilterFunc:
  * @stream: a #GstRTSPStream object
-- 
2.15.0

